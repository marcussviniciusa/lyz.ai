# üß† Sistema RAG Integrado - Medicina Funcional e Integrativa

## üéØ **Vis√£o Geral**
Sistema de **Retrieval-Augmented Generation (RAG)** completamente integrado √†s an√°lises de **MTC**, **Cronologia**, **Matriz IFM** e **Plano de Tratamento**, fornecendo contexto cient√≠fico especializado para cada tipo de an√°lise.

---

## üîß **Arquitetura Implementada**

### **1. RAGAnalysisService Aprimorado**
- **Queries Inteligentes**: Baseadas no perfil da paciente e tipo de an√°lise
- **Busca Contextual**: M√∫ltiplas estrat√©gias de busca com fallback
- **Extra√ß√£o de Protocolos**: Identifica√ß√£o autom√°tica de protocolos e recomenda√ß√µes
- **Contexto Personalizado**: Adaptado ao perfil hormonal e idade da paciente

### **2. Categoriza√ß√£o de Documentos**
```typescript
const categoryMap = {
  'tcm': ['mtc', 'fitoterapia', 'medicina-funcional', 'protocolos-clinicos'],
  'ifm': ['medicina-funcional', 'protocolos-clinicos', 'diretrizes-medicas'],
  'chronology': ['medicina-funcional', 'pesquisas-cientificas', 'estudos-caso'],
  'treatment-plan': ['protocolos-clinicos', 'medicina-funcional', 'diretrizes-medicas', 'fitoterapia', 'nutricao']
}
```

### **3. Queries Inteligentes por An√°lise**

#### **üèÆ MTC (Medicina Tradicional Chinesa)**
- Diagn√≥stico por l√≠ngua e pulso espec√≠ficos
- Padr√µes energ√©ticos femininos (Qi/Sangue, Yang/Yin)
- Fitoterapia chinesa e acupuntura contextual
- Exemplo: `l√≠ngua p√°lida diagn√≥stico MTC`, `yang defici√™ncia rim sintomas`

#### **üìÖ Cronologia de Sa√∫de**
- Eventos traum√°ticos e gatilhos autoimunes
- Marcos hormonais femininos
- Timeline de progress√£o de sintomas
- Exemplo: `trauma emocional doen√ßas autoimunes`, `cronologia hormonal feminina marcos`

#### **üß¨ Matriz IFM (Medicina Funcional)**
- Protocolos espec√≠ficos por sistema (7 sistemas funcionais)
- Interconex√µes sist√™micas
- Causas raiz de doen√ßas cr√¥nicas
- Exemplo: `disbiose intestinal protocolo`, `fadiga mitocondrial suplementos`

#### **üíä Plano de Tratamento**
- Protocolos terap√™uticos integrados
- Medicina personalizada feminina
- Cronogramas de acompanhamento
- Exemplo: `protocolo hormonal bioid√™ntico`, `medicina personalizada feminina`

---

## üöÄ **Funcionalidades Implementadas**

### **1. Busca Contextual Inteligente**
```typescript
// Baseada no perfil da paciente
if (age >= 40 && menstrualStatus === 'pre') {
  queries.push('perimenopausa sintomas tratamento')
  queries.push('transi√ß√£o hormonal mulher 40 anos')
}

// Por sintomas espec√≠ficos
symptoms.forEach(symptom => {
  queries.push(`tratamento ${symptom} medicina integrativa`)
  queries.push(`${symptom} mulher ${menstrualStatus}menopausal`)
})
```

### **2. Detec√ß√£o Autom√°tica de Biomarcadores**
```typescript
// Para an√°lises laboratoriais
if (labText.includes('tsh')) {
  queries.push('TSH alterado medicina funcional protocolo')
  queries.push('hashimoto hipotireoidismo fitoterapia')
}

if (labText.includes('cortisol')) {
  queries.push('fadiga adrenal cortisol protocolo')
  queries.push('adapt√≥genos cortisol medicina funcional')
}
```

### **3. Contexto Cient√≠fico Estruturado**
```typescript
const contextHeader = `
=== CONTEXTO CIENT√çFICO PARA ${type.toUpperCase()} ===
PERFIL DA PACIENTE: ${name}, ${age} anos, Status: ${menstrualStatus}

EVID√äNCIAS CIENT√çFICAS DISPON√çVEIS:
1. [üî¨ ALTA] Protocolo_Hashimoto_2024.pdf:
   Tratamento integrado para tireoidite de Hashimoto...

=== INSTRU√á√ïES ===
Utilize estas evid√™ncias para fundamentar recomenda√ß√µes.
Cite fontes e adapte ao perfil espec√≠fico da paciente.
`
```

### **4. Metadados de Qualidade**
```typescript
ragMetadata = {
  documentsUsed: ragResult.relevantDocuments.length,
  searchQueries: ragResult.searchQueries,
  evidenceLevel: 'alta|m√©dia|baixa',
  protocolsFound: ragResult.specificContext?.protocols?.length,
  clinicalRecommendations: ragResult.specificContext?.clinicalRecommendations?.length
}
```

---

## üìä **Fluxo de Integra√ß√£o**

### **Antes (Sistema B√°sico)**
```mermaid
graph TD
    A[Dados da Paciente] --> B[Prompt B√°sico]
    B --> C[IA OpenAI]
    C --> D[An√°lise Gen√©rica]
```

### **Depois (Sistema RAG Integrado)**
```mermaid
graph TD
    A[Dados da Paciente] --> B[RAG Analysis Service]
    B --> C[Queries Inteligentes]
    C --> D[Busca em Documentos]
    D --> E[Contexto Cient√≠fico]
    E --> F[Prompt Enriquecido]
    F --> G[IA OpenAI]
    G --> H[An√°lise Fundamentada]
```

---

## üéØ **Benef√≠cios Implementados**

### **1. An√°lises Mais Precisas**
- ‚úÖ Fundamenta√ß√£o cient√≠fica em protocolos validados
- ‚úÖ Recomenda√ß√µes baseadas em evid√™ncias
- ‚úÖ Contextualiza√ß√£o por perfil hormonal

### **2. Protocolos Espec√≠ficos**
- ‚úÖ MTC: F√≥rmulas herbais e pontos de acupuntura espec√≠ficos
- ‚úÖ IFM: Protocolos por sistema funcional
- ‚úÖ Cronologia: Correla√ß√µes temporais e gatilhos
- ‚úÖ Tratamento: Planos integrados e personalizados

### **3. Qualidade da Informa√ß√£o**
- ‚úÖ N√≠veis de evid√™ncia (Alta/M√©dia/Baixa)
- ‚úÖ Rastreamento de fontes
- ‚úÖ Fallback gracioso se RAG falhar

### **4. Personaliza√ß√£o Avan√ßada**
- ‚úÖ Adapta√ß√£o por idade e status hormonal
- ‚úÖ Sintomas espec√≠ficos da paciente
- ‚úÖ Hist√≥rico m√©dico considerado

---

## üîç **Exemplo Pr√°tico de Uso**

### **Cen√°rio: Paciente com Hashimoto**
```typescript
// Entrada
const patient = {
  name: "Maria Silva",
  age: 35,
  mainSymptoms: ["fadiga", "ganho de peso", "depress√£o"],
  menstrualHistory: { menopausalStatus: "pre" }
}

const tcmData = {
  tongueColor: "pale",
  lingualObservation: { coating: "white" }
}

// Queries RAG Geradas Automaticamente
[
  "fadiga tratamento medicina integrativa",
  "ganho peso mulher premenopausal", 
  "l√≠ngua p√°lida diagn√≥stico MTC",
  "saburra lingual white medicina chinesa",
  "yang defici√™ncia rim sintomas",
  "tireoidite hashimoto MTC tratamento"
]

// Contexto RAG Encontrado
=== CONTEXTO CIENT√çFICO PARA MEDICINA TRADICIONAL CHINESA ===
PERFIL DA PACIENTE: Maria Silva, 35 anos, Status: pre

EVID√äNCIAS CIENT√çFICAS DISPON√çVEIS:
1. [üî¨ ALTA] Protocolo_Hashimoto_MTC_2024.pdf:
   Yang do Rim deficiente com ac√∫mulo de umidade...
   F√≥rmula: You Gui Wan modificada + Gan Mai Da Zao Tang
   Pontos: Shenmen, Yintang, Zusanli, Shenshu, Mingmen

2. [üìä M√âDIA] Estudo_Fadiga_Acupuntura_2023.pdf:
   Protocolo de 12 sess√µes para fadiga cr√¥nica...
```

### **Resultado: An√°lise Enriquecida**
A IA agora gerar√° uma an√°lise MTC fundamentada em protocolos espec√≠ficos para Hashimoto, com f√≥rmulas herbais validadas e pontos de acupuntura comprovados, adaptados ao perfil hormonal da paciente.

---

## üöÄ **Pr√≥ximos Passos Sugeridos**

### **1. Upload de Documentos Especializados**
- Protocolos de medicina funcional para cada sistema IFM
- Estudos de MTC para ginecologia
- Guidelines de horm√¥nios bioid√™nticos
- Pesquisas sobre cronologia de doen√ßas autoimunes

### **2. Refinamento Cont√≠nuo**
- An√°lise de feedback das an√°lises geradas
- Otimiza√ß√£o das queries baseada nos resultados
- Expans√£o das categorias de documentos

### **3. Interface de Gest√£o RAG**
- Dashboard de documentos por categoria
- Estat√≠sticas de uso do RAG por an√°lise
- Qualidade dos resultados por tipo

---

## üí° **Status de Implementa√ß√£o**

‚úÖ **COMPLETO**: Sistema RAG integrado a todas as an√°lises  
‚úÖ **COMPLETO**: Queries inteligentes por tipo e perfil  
‚úÖ **COMPLETO**: Contexto cient√≠fico estruturado  
‚úÖ **COMPLETO**: Metadados de qualidade  
‚úÖ **COMPLETO**: Fallback gracioso  

**O sistema est√° pronto para uso em produ√ß√£o! üéâ** 

# Sistema RAG Integrado - Lyz.ai

## Vis√£o Geral

O Sistema RAG (Retrieval-Augmented Generation) integrado ao Lyz.ai combina intelig√™ncia artificial generativa com base de conhecimento cient√≠fico espec√≠fica, proporcionando an√°lises m√©dicas fundamentadas em evid√™ncias atualizadas.

## Arquitetura e Componentes

### 1. Documentos e Categoriza√ß√£o

#### Categorias Suportadas:
- **Pesquisas Cient√≠ficas**: Artigos e estudos peer-reviewed
- **Protocolos Cl√≠nicos**: Diretrizes de tratamento padronizadas
- **Diretrizes M√©dicas**: Recomenda√ß√µes de sociedades m√©dicas
- **Estudos de Caso**: Relatos cl√≠nicos detalhados
- **Medicina Funcional**: Abordagens funcionais e integrativas
- **MTC (Medicina Tradicional Chinesa)**: Acupuntura, fitoterapia chinesa
- **Fitoterapia**: Plantas medicinais e compostos naturais
- **Nutri√ß√£o**: Protocolos nutricionais e suplementa√ß√£o
- **üÜï Cursos e Transcri√ß√µes**: Documentos educacionais abrangentes

#### Processamento de Documentos Multi-T√≥pico

O sistema foi otimizado para lidar com documentos como **transcri√ß√µes de cursos** que abordam m√∫ltiplos assuntos:

**Estrat√©gias de Busca H√≠brida:**
1. **Busca Categ√≥rica**: Nas categorias espec√≠ficas mapeadas
2. **Busca Global**: Em todas as categorias para capturar conte√∫do transversal
3. **Busca Ampla**: Fallback com queries gen√©ricas

**Exemplo de Mapeamento para Transcri√ß√£o de Curso:**
```typescript
'treatment-plan': [
  'protocolos-clinicos', 
  'medicina-funcional', 
  'diretrizes-medicas', 
  'fitoterapia', 
  'nutricao',
  'mtc',
  'pesquisas-cientificas',
  'estudos-caso',
  'cursos-transcricoes' // ‚Üê Captura transcri√ß√µes educacionais
]
```

### 2. Integra√ß√£o com as 4 An√°lises Principais

#### An√°lise de MTC (Medicina Tradicional Chinesa)
**Categorias de Busca:** `mtc`, `fitoterapia`, `medicina-funcional`, `protocolos-clinicos`, `diretrizes-medicas`, `estudos-caso`, `cursos-transcricoes`

**Queries Espec√≠ficas Geradas:**
- Observa√ß√£o lingual: `l√≠ngua ${cor} diagn√≥stico MTC`
- An√°lise de pulso: `pulso ${qualidade} medicina chinesa`
- Padr√µes energ√©ticos: `Qi sangue estagna√ß√£o mulher`
- Ginecologia: `padr√µes MTC ginecologia feminina`

#### An√°lise de Cronologia
**Categorias de Busca:** `medicina-funcional`, `pesquisas-cientificas`, `estudos-caso`, `protocolos-clinicos`, `diretrizes-medicas`, `mtc`, `cursos-transcricoes`

**Queries Espec√≠ficas Geradas:**
- Eventos significativos: `${evento.categoria} ${evento.descri√ß√£o} impacto sa√∫de`
- Marcos hormonais: `cronologia hormonal feminina marcos`
- Gatilhos: `trauma emocional doen√ßas autoimunes`

#### An√°lise da Matriz IFM
**Categorias de Busca:** `medicina-funcional`, `protocolos-clinicos`, `diretrizes-medicas`, `pesquisas-cientificas`, `estudos-caso`, `nutricao`, `cursos-transcricoes`

**Queries por Sistema Funcional:**
- Assimila√ß√£o: `disbiose intestinal protocolo tratamento`
- Defesa/Reparo: `autoimunidade mulher protocolo`
- Energia: `fadiga mitocondrial protocolo`
- Biotransforma√ß√£o: `detoxifica√ß√£o hep√°tica protocolo`
- Transporte: `sa√∫de cardiovascular mulher`
- Comunica√ß√£o: `desequil√≠brio hormonal protocolo`
- Integridade Estrutural: `for√ßa muscular medicina funcional`

#### Plano de Tratamento Final
**Categorias de Busca:** Todas as categorias (busca mais abrangente)

**Integra√ß√£o Completa:**
- S√≠ntese de todas as an√°lises anteriores
- Protocolos espec√≠ficos por especializa√ß√£o
- Recomenda√ß√µes baseadas em evid√™ncias
- Cronograma de acompanhamento

### 3. Otimiza√ß√µes para Documentos Abrangentes

#### Identifica√ß√£o de Fontes Educacionais
O sistema automaticamente identifica e destaca documentos que contribuem com m√∫ltiplas se√ß√µes:

```typescript
üìö DOCUMENTOS ABRANGENTES IDENTIFICADOS:
‚Ä¢ Transcricao_Curso_Medicina_Funcional.pdf (7 se√ß√µes relevantes, relev√¢ncia m√©dia: 85.3%)
‚Ä¢ Workshop_Integrativo_Saude_Feminina.pdf (4 se√ß√µes relevantes, relev√¢ncia m√©dia: 78.1%)
```

#### Contextualiza√ß√£o Inteligente
**Antes da Otimiza√ß√£o:**
```
1. [üî¨ ALTA] documento.pdf:
   Texto do chunk...
```

**Ap√≥s a Otimiza√ß√£o:**
```
1. [üî¨ ALTA] Transcricao_Curso_Medicina_Funcional.pdf üìö [CURSO/FONTE ABRANGENTE]:
   Texto do chunk...
```

### 4. M√©tricas e Monitoramento

#### Rastreamento de Uso do RAG
```typescript
ragMetadata = {
  documentsUsed: 5,
  searchQueries: ['query1', 'query2'],
  evidenceLevel: 'alta',
  protocolsFound: 3,
  clinicalRecommendations: 8
}
```

#### Distribui√ß√£o de Resultados
```
üìä RAG encontrou 5 documentos relevantes
üìà Distribui√ß√£o: 3 espec√≠ficos, 2 globais, 0 amplos
```

### 5. Fluxo de Integra√ß√£o

#### Para Cada An√°lise:
1. **Gera√ß√£o de Queries Inteligentes** baseadas nos dados da paciente
2. **Busca Multi-Estrat√©gica** (categ√≥rica + global + ampla)
3. **Deduplica√ß√£o e Ranking** por relev√¢ncia
4. **Contextualiza√ß√£o Cient√≠fica** com evid√™ncias
5. **Integra√ß√£o no Prompt** da IA
6. **An√°lise H√≠brida** (IA + Conhecimento)

#### Resultado Final:
```json
{
  "analysis": "An√°lise gerada pela IA",
  "ragContext": {
    "relevantDocuments": [...],
    "searchQueries": [...],
    "contextSummary": "Contexto cient√≠fico estruturado"
  },
  "metadata": {
    "enhancedWithRAG": true,
    "documentsUsed": 5,
    "evidenceLevel": "alta"
  }
}
```

### 6. Configura√ß√£o por Empresa

Cada empresa pode:
- ‚úÖ **Habilitar/Desabilitar RAG** por tipo de an√°lise
- ‚úÖ **Personalizar threshold** de relev√¢ncia (0.1 a 1.0)
- ‚úÖ **Monitorar m√©tricas** de uso e efic√°cia
- ‚úÖ **Categorizar documentos** incluindo cursos abrangentes
- ‚úÖ **Visualizar impacto** na qualidade das an√°lises

### 7. Benef√≠cios da Integra√ß√£o RAG

#### Para An√°lises:
- üìö **Fundamenta√ß√£o Cient√≠fica**: Cada recomenda√ß√£o baseada em evid√™ncias
- üéØ **Personaliza√ß√£o Inteligente**: Queries espec√≠ficas por paciente
- üîÑ **Atualiza√ß√£o Cont√≠nua**: Novos documentos melhoram automaticamente
- üìä **Rastreabilidade Completa**: M√©tricas detalhadas de fontes utilizadas
- üß† **IA H√≠brida**: Combina√ß√£o de criatividade generativa + conhecimento estruturado

#### Para Documentos Multi-T√≥pico:
- üéì **Aproveitamento M√°ximo**: Transcri√ß√µes de cursos beneficiam todas as an√°lises
- üîç **Busca Inteligente**: Sistema identifica automaticamente conte√∫do relevante
- üìã **Contextualiza√ß√£o Clara**: Destaque especial para fontes abrangentes
- ‚ö° **Efici√™ncia Otimizada**: Uma fonte alimenta m√∫ltiplas especialidades

---

**Status de Implementa√ß√£o:** ‚úÖ Totalmente funcional e otimizado
**√öltima Atualiza√ß√£o:** Dezembro 2024
**Pr√≥ximas Melhorias:** Auto-categoriza√ß√£o de documentos por IA 